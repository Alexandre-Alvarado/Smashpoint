{% extends 'base.html' %}
{% block title %}Grupos - {{ torneo.nombre }}{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="h5 mb-0">Grupos - {{ torneo.nombre }}</h2>
  <div class="btn-group btn-group-sm">
    <a href="{% url 'lista_torneos' %}" class="btn btn-outline-secondary">‚Üê Torneos</a>
    <a href="{% url 'generar_bracket' torneo.id %}" class="btn btn-outline-primary" onclick="return confirm('Generar bracket eliminaci√≥n? Deben estar todos los partidos de grupos resueltos.')">Generar Bracket</a>
    <a href="{% url 'bracket_visual' torneo.id %}" class="btn btn-outline-info">Ver Bracket</a>
  </div>
</div>

{% for item in grupos_data %}
  <!-- Card de Estad√≠sticas del Grupo -->
  <div class="card mb-4 shadow-sm border-0">
    <div class="card-header py-3 d-flex justify-content-between align-items-center bg-primary text-white">
      <h5 class="mb-0">üìä Grupo {{ item.grupo.nombre }}</h5>
      <span class="badge bg-light text-primary">{{ item.tabla|length }} jugadores</span>
    </div>
    <div class="card-body p-0">
      <table class="table mb-0 table-sm align-middle">
        <thead class="table-light">
          <tr>
            <th>Jugador</th>
            <th class="text-center">PJ</th>
            <th class="text-center">PG</th>
            <th class="text-center">PP</th>
            <th class="text-center">Sets (+/-)</th>
          </tr>
        </thead>
        <tbody>
        {% for row in item.tabla %}
          <tr>
            <td><strong>{{ row.jugador.nombre }} {{ row.jugador.apellido }}</strong></td>
            <td class="text-center">{{ row.PJ }}</td>
            <td class="text-center"><span class="badge bg-success">{{ row.PG }}</span></td>
            <td class="text-center"><span class="badge bg-danger">{{ row.PP }}</span></td>
            <td class="text-center"><span class="badge bg-{% if row.SA > row.SB %}success{% else %}secondary{% endif %}">{{ row.SA }} - {{ row.SB }}</span></td>
          </tr>
        {% empty %}
          <tr><td colspan="5" class="text-center text-muted small">Sin datos.</td></tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Card de Partidos del Grupo -->
  <div class="card mb-4 shadow-sm border-0">
    <div class="card-header py-3 bg-success text-white">
      <h5 class="mb-0">‚ö° Partidos - Grupo {{ item.grupo.nombre }}</h5>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table mb-0 table-sm table-hover">
          <thead class="table-light">
            <tr>
              <th>Ronda</th>
              <th>Jugador A</th>
              <th class="text-center">vs</th>
              <th>Jugador B</th>
              <th class="text-center">Sets</th>
              <th class="text-center">Ganador</th>
              <th class="text-center">Acciones</th>
            </tr>
          </thead>
          <tbody>
          {% for partido in item.partidos %}
            <tr class="{% if partido.ganador %}table-success{% endif %}">
              <td><span class="badge bg-info">{{ partido.ronda }}</span></td>
              <td>{{ partido.jugador_a }}</td>
              <td class="text-center text-muted">vs</td>
              <td>{{ partido.jugador_b }}</td>
              <td class="text-center">
                {% if partido.sets_a is not None %}
                  <span class="badge bg-dark">{{ partido.sets_a }} - {{ partido.sets_b }}</span>
                {% else %}
                  <span class="text-muted small">Pendiente</span>
                {% endif %}
              </td>
              <td class="text-center">
                {% if partido.ganador %}
                  <strong>{{ partido.ganador }}</strong>
                {% else %}
                  <span class="text-muted small">-</span>
                {% endif %}
              </td>
              <td class="text-center">
                <a href="{% url 'editar_partido' partido.id %}" class="btn btn-sm btn-outline-primary">‚úèÔ∏è Editar</a>
              </td>
            </tr>
          {% empty %}
            <tr><td colspan="7" class="text-center text-muted small py-3">No hay partidos registrados.</td></tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
{% endfor %}
{% endblock %}